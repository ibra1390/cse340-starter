<h1><%= title %></h1>

<%- messages() %>

<% if (loggedin) { %>
  <div class="account-management">
    <!-- 1. Greeting (for ALL users) -->
    <h2>Welcome <%= accountData.account_firstname %></h2>
    <p>You're logged in.</p> 

    <!-- 2. Update link (REQUIRED for all) -->
    <p>
      <a href="/account/update/<%= accountData.account_id %>" class="update-link">
        Update Account Information
      </a>
    </p>

    <!-- 3. Inventory section (ONLY for Employee/Admin) -->
    <% if (accountData.account_type === "Employee" || accountData.account_type === "Admin") { %>
      <div class="inventory-section">
        <h3>Inventory Management</h3> 
        <p><a href="/inv" class="inventory-link">Manage Inventory</a></p> 
      </div>
    <% } %>

    <!-- 4. User Reviews Section -->
    <div class="user-reviews-section">
      <h3>Your Reviews</h3>
      
      <% if (locals.reviews && locals.reviews.rows && locals.reviews.rows.length > 0) { %>
        <ul class="user-reviews-list">
          <% locals.reviews.rows.forEach(review => { %>
            <li class="user-review-item">
              <div class="review-vehicle">
                <strong><%= review.inv_make %> <%= review.inv_model %></strong>
                <span class="review-date"><%= new Date(review.review_date).toLocaleDateString() %></span>
              </div>
              <p class="review-text"><%= review.review_text %></p>
              <div class="review-actions">
                <a href="/review/edit/<%= review.review_id %>" class="btn-edit">Edit</a>
                <form action="/review/delete/<%= review.review_id %>" method="post" class="form-delete">
                  <input type="hidden" name="_method" value="DELETE">
                  <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this review?');">Delete</button>
                </form>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p class="no-reviews">You haven't written any reviews yet.</p>
      <% } %>
    </div>
  </div>
<% } %>